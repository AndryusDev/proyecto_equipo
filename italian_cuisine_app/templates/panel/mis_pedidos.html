{% extends 'panel_base.html' %}
{% load static %}
{% block titulo %}Mis Pedidos{% endblock %}

{% block contenido %}
<link rel="stylesheet" href="{% static 'css/mis_pedidos.css' %}">

<section class="panel">
  <div class="panel-header">
    <h2>ðŸ“‹ Mis Pedidos</h2>
  </div>

  {% if pedidos %}
    <div class="lista-pedidos">
      {% for pedido in pedidos %}
        <div class="pedido-card {{ pedido.estado }}">
          <div class="pedido-header">
            <h3>Pedido #{{ pedido.id }}</h3>
            <span class="estado {{ pedido.estado }}">{{ pedido.get_estado_display }}</span>
          </div>
          <div class="pedido-info">
            <p><strong>Mesa:</strong> {{ pedido.mesa.numero }}</p>
            <p><strong>Fecha:</strong> {{ pedido.fecha|date:"d/m/Y H:i" }}</p>
            <p><strong>Total:</strong> ${{ pedido.total }}</p>
          </div>

          <div class="pedido-detalle">
            <ul>
              {% for detalle in pedido.detallepedido_set.all %}
                <li>
                  <span>{{ detalle.plato.nombre }}</span>
                  <span>x {{ detalle.cantidad }}</span>
                  <span>${{ detalle.subtotal }}</span>
                </li>
              {% endfor %}
            </ul>
          </div>

          {% if pedido.estado != 'cerrado' %}
            <form method="post" action="{% url 'cerrar_pedido' pedido.id %}">
              {% csrf_token %}
              <button type="submit" class="btn-cerrar">Cerrar Pedido</button>
            </form>
          {% else %}
            <p class="pedido-cerrado">âœ… Pedido cerrado</p>
          {% endif %}
        </div>
      {% endfor %}
    </div>
  {% else %}
    <p class="sin-pedidos">AÃºn no has registrado pedidos.</p>
  {% endif %}
</section>
{% endblock %}
